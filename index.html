<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>忍術バトル Ver.22</title>

<style>
body{
    font-family:sans-serif;
    text-align:center;
    background:#1a1a1a;
    color:#fff;
    margin:0;
    overflow:hidden;
    height:100vh;
    display:flex;
    flex-direction:column
}

#menu-screen{
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,.95);
    z-index:200;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:20px;
    overflow-y:auto
}

.btn-group{
    display:flex;
    flex-direction:column;
    gap:10px;
    margin-bottom:15px
}

.mode-btn{
    width:260px;
    padding:12px;
    font-size:1rem;
    background:#444;
    color:#fff;
    border:2px solid #666;
    border-radius:10px;
    cursor:pointer;
    font-weight:700
}

.mode-btn.selected{
    background:#e74c3c;
    border-color:#fff;
    box-shadow:0 0 15px #e74c3c
}

.start-btn{
    width:200px;
    padding:15px;
    background:#27ae60;
    color:#fff;
    border:none;
    border-radius:30px;
    font-size:1.2rem;
    font-weight:700;
    cursor:pointer
}

.player-area{
    height:40%;
    display:flex;
    flex-direction:column;
    justify-content:center;
    padding:10px;
    position:relative
}

#p2-area{
    transform:rotate(180deg);
    border-bottom:2px solid #444
}

#p1-area{
    border-top:2px solid #444
}

.hand{
    display:flex;
    justify-content:center;
    gap:8px;
    flex-wrap:wrap
}

/* ======================
   カード
====================== */
.card{
    width:60px;
    height:82px;
    border:2px solid #fff;
    border-radius:8px;
    cursor:pointer;
    overflow:hidden;
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;

    transition:
        transform 0.2s ease,
        box-shadow 0.2s ease,
        border-color 0.2s ease;
}

.card[data-type="火"]{background:#d32f2f}
.card[data-type="水"]{background:#1976d2}
.card[data-type="土"]{background:#f57c00}
.card[data-type="風"]{background:#388e3c}
.card[data-type="雷"]{background:#fbc02d}

.card img{
    width:100%;
    height:100%;
    object-fit:cover;
    position:absolute;
    top:0;left:0;
    z-index:1
}

.card-label{
    font-size:16px;
    font-weight:900;
    z-index:2;
    text-shadow:1px 1px 3px #000;
    background:rgba(0,0,0,0.3);
    width:100%;
    padding:2px 0
}

/* ★ 選択中演出 */
.card.selected{
    transform: translateY(-12px);
    border-color:#f1c40f;
    box-shadow:
        0 0 10px rgba(241,196,15,0.9),
        0 6px 12px rgba(0,0,0,0.6);
    z-index:50;
}

.card:not(.selected):hover{
    transform: translateY(-4px);
    box-shadow:0 4px 8px rgba(0,0,0,0.5);
}

/* ======================
   中央UI
====================== */
#battle-center{
    height:20%;
    background:rgba(0,0,0,.7);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:10
}

/* ★ 決定ボタン修正ポイント */
.decide-btn{
    width:150px;
    height:40px;
    font-size:1.1rem;
    border-radius:20px;
    border:none;
    background:#e74c3c;
    color:#fff;
    font-weight:700;
    cursor:pointer;

    position:relative;
    z-index:200;   /* ← これが重要 */
}

.waiting{
    opacity:.1;
    pointer-events:none
}

#flash-div{
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    z-index:1000;
    pointer-events:none
}

@keyframes flash{
    0%{opacity:0}
    50%{background:#fff;opacity:0.8}
    100%{opacity:0}
}
</style>
</head>

<body>

<div id="menu-screen">
    <h2>忍術バトル Ver.22</h2>
    <div class="btn-group">
        <button id="m-norm" class="mode-btn selected" onclick="selMode('N')">ノーマル (3戦)</button>
        <button id="m-adv" class="mode-btn" onclick="selMode('A')">アドバンス (5戦)</button>
    </div>
    <div class="btn-group">
        <button id="p-com" class="mode-btn selected" onclick="selPlay('C')">1人 (vs COM)</button>
        <button id="p-pvp" class="mode-btn" onclick="selPlay('P')">2人対戦</button>
    </div>
    <button class="start-btn" onclick="applyStart()">修行開始！</button>
</div>

<div id="flash-div"></div>

<div id="p2-area" class="player-area">
    <div id="p2-hand" class="hand"></div>
    <button id="p2-btn" class="decide-btn" onclick="confirmMove(2)">決定</button>
</div>

<div id="battle-center">
    <div id="status-msg">修行の時間だ</div>
    <div id="last-moves" style="font-weight:bold;color:#f1c40f;">P1:? vs P2:?</div>
    <div id="score-line">P1:0 | P2:0</div>
</div>

<div id="p1-area" class="player-area">
    <button id="p1-btn" class="decide-btn" onclick="confirmMove(1)">決定</button>
    <div id="p1-hand" class="hand"></div>
</div>

<script>
const library={
'火':['https://livedoor.blogimg.jp/pokeruto_narutostorm/imgs/9/d/9df794cc.png'],
'水':['https://ooyake01.com/wp-content/uploads/2019/07/%E6%89%89%E9%96%93.png'],
'土':['https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQgUZKzoGoqlDT7mUC9X8fE76pwS8yTZOsQJWSf0JLyzQ&s'],
'風':['https://otakotaku.com/asset/img/character/2017/10/uzumaki-naruto-59dbafb3a0d9ep.jpg'],
'雷':['https://images-na.ssl-images-amazon.com/images/I/71rse6gO0XL._CR550,250,1420,1420_.jpg']
};

let icons={'火':library['火'][0],'水':library['水'][0],'土':library['土'][0],'風':library['風'][0],'雷':library['雷'][0]};
const rel={'火':'風','風':'雷','雷':'土','土':'水','水':'火'};
const typeOrd={'火':1,'水':2,'土':3,'風':4,'雷':5};
const types=['火','水','土','風','雷'];

let hands,scores,selected,confirmed,turn,gMode='N',pMode='C',p1D=[],p2D=[],firstPt=null;

function selMode(m){
    gMode=m;
    document.querySelectorAll('.btn-group')[0].querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
    document.getElementById(m==='N'?'m-norm':'m-adv').classList.add('selected');
}

function selPlay(p){
    pMode=p;
    document.querySelectorAll('.btn-group')[1].querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
    document.getElementById(p==='C'?'p-com':'p-pvp').classList.add('selected');
}

function applyStart(){
    document.getElementById('menu-screen').style.display='none';
    initGame();
}

function initGame(){
    hands={1:[...types],2:[...types]};
    scores={1:0,2:0};
    selected={1:[],2:[]};
    confirmed={1:false,2:false};
    turn=1;firstPt=null;p1D=[];p2D=[];
    renderHands();
}

function renderHands(){
    for(let p=1;p<=2;p++){
        const t=document.getElementById(`p${p}-hand`);
        t.innerHTML="";
        hands[p].forEach(n=>{
            const isSel=selected[p].includes(n);
            const o=document.createElement("div");
            o.className=`card ${isSel?"selected":""}`;
            o.dataset.type=n;
            o.innerHTML=`<img src="${icons[n]}"><div class="card-label">${n}</div>`;
            o.onclick=()=>{
                if(!confirmed[p]){
                    isSel?selected[p]=selected[p].filter(x=>x!==n):selected[p].push(n);
                    renderHands();
                }
            };
            t.appendChild(o);
        });
    }
}
</script>

</body>
</html>
